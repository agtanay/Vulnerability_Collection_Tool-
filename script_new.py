#!flask/bin/python
# -*- coding: utf-8 -*-
import smtplib
import os
from flask import Flask
from flask import render_template
from flask import request
from time import gmtime, strftime
import csv
import datetime

app = Flask(__name__)

@app.route('/')
def home():
    return render_template('home.html')

serial = 520
@app.route('/addvul', methods=["POST"])
def updateStatus():
    global serial
    serial += 1
    vulname = request.form["vul_name"]
    vulname = vulname.encode('utf-8').strip()
    desc = request.form["vul_desc"]
    desc = desc.encode('utf-8').strip()
    like = request.form["vul_likelihood"]
    like = like.encode('utf-8').strip()
    impact = request.form["vul_impact"]
    impact = impact.encode('utf-8').strip()
    sev = request.form["vul_severity"]
    sev = sev.encode('utf-8').strip()
    rem = request.form["vul_rem"]
    rem = rem.encode('utf-8').strip()
    threat_cap = request.form["threat_cap"]
    threat_cap = threat_cap.encode('utf-8').strip()
    cvss_string=request.form["vul_cvssstring"]
    cvss_string= cvss_string.encode('utf-8').strip()	
    cvss3_string=request.form["vul_cvss3string"]
    cvss3_string= cvss3_string.encode('utf-8').strip()
    cvss3_score=request.form["vul_cvss3score"]
    cvss3_score= cvss3_score.encode('utf-8').strip()
    ext_ref=request.form["ext_ref"]
    ext_ref= ext_ref.encode('utf-8').strip()
    cwe=request.form["vul_cwe"]
    cwe= cwe.encode('utf-8').strip()
    practice=request.form["Practice"]
    practice=practice.encode('utf-8').strip()
    my_list = [serial, vulname, desc, like, impact, sev, rem, threat_cap, cvss_string, cvss3_string, cvss3_score, ext_ref, cwe, practice]
    if checkFileExist("CVD_sheet.csv"):
        with open("CVD_sheet.csv", "a") as myfile:
            wr = csv.writer(myfile, lineterminator='\n')
            wr.writerow(my_list)
    else:
        with open("newcsv.csv","a") as myfile:
            wr = csv.writer(myfile, lineterminator='\n')
            wr.writerow(my_list)            
    
    return "Congrats! Your job is done. Vulnerability is added successfully"


def checkFileExist(path):
    return os.path.isfile(path)


if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0')
